<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tournament Host Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        /* Previous CSS remains the same, adding only new styles for edit functionality */
        
        /* Edit Team Modal */
        .edit-team-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            animation: fadeIn 0.3s ease;
            overflow-y: auto;
        }

        .edit-team-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--dark);
            padding: 30px;
            border-radius: 15px;
            max-width: 800px;
            width: 95%;
            max-height: 90vh;
            overflow-y: auto;
            border: 2px solid var(--secondary);
            box-shadow: 0 20px 40px rgba(0,0,0,0.5);
        }

        .edit-team-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 2px solid var(--secondary);
            padding-bottom: 15px;
        }

        .edit-team-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .form-section {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 10px;
            border-left: 3px solid var(--secondary);
        }

        .form-section h3 {
            color: var(--secondary);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }

        .form-row.full-width {
            grid-template-columns: 1fr;
        }

        .players-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .player-form {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid var(--card-border);
        }

        .player-form h4 {
            color: var(--secondary);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .edit-team-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .edit-team-btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .edit-team-btn.save {
            background: var(--success);
            color: white;
        }

        .edit-team-btn.cancel {
            background: var(--accent);
            color: white;
        }

        .edit-team-btn:hover {
            transform: translateY(-2px);
        }

        /* Team actions buttons */
        .team-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            justify-content: center;
        }

        .team-action-btn {
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .team-action-btn:hover {
            transform: scale(1.05);
        }

        .view-details-btn {
            background: var(--info);
            color: white;
        }

        .edit-team-btn-action {
            background: var(--warning);
            color: white;
        }

        .remove-team-btn {
            background: var(--accent);
            color: white;
        }

        /* Rest of the CSS remains the same */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary: #1a5e1a;
            --secondary: #d4af37;
            --accent: #c62828;
            --light: #f5f5f5;
            --dark: #0d3d0d;
            --success: #4CAF50;
            --warning: #FF9800;
            --info: #2196F3;
            --card-bg: rgba(255, 255, 255, 0.08);
            --card-border: rgba(255, 255, 255, 0.15);
        }

        body {
            background: linear-gradient(135deg, var(--primary) 0%, var(--dark) 100%);
            color: var(--light);
            line-height: 1.6;
            min-height: 100vh;
            background-attachment: fixed;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        header {
            background: rgba(0, 0, 0, 0.7);
            padding: 30px;
            text-align: center;
            margin-bottom: 30px;
            border-radius: 15px;
            animation: slideDown 0.8s ease-out;
            border: 2px solid var(--secondary);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            backdrop-filter: blur(10px);
        }

        .title {
            font-size: 2.5rem;
            background: linear-gradient(to right, var(--secondary), #fff, var(--secondary));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 15px;
            text-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        /* Login Section */
        .login-section {
            background: var(--card-bg);
            padding: 30px;
            border-radius: 15px;
            max-width: 500px;
            margin: 0 auto 30px;
            text-align: center;
            animation: fadeInUp 0.8s ease-out;
            backdrop-filter: blur(10px);
            border: 1px solid var(--card-border);
        }

        .login-section h2 {
            color: var(--secondary);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--secondary);
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid var(--card-border);
            background: rgba(0, 0, 0, 0.3);
            color: white;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: var(--secondary);
            transform: scale(1.02);
            box-shadow: 0 0 15px rgba(212, 175, 55, 0.3);
        }

        .submit-btn {
            background: linear-gradient(135deg, var(--secondary), #e6c44c);
            color: var(--primary);
            padding: 15px 40px;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: 10px;
            position: relative;
            overflow: hidden;
        }

        .submit-btn:before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            transition: left 0.5s;
        }

        .submit-btn:hover:before {
            left: 100%;
        }

        .submit-btn:hover {
            background: linear-gradient(135deg, #e6c44c, var(--secondary));
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
        }

        .submit-btn:active {
            transform: translateY(0);
        }

        /* Dashboard */
        .dashboard {
            display: none;
        }

        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 20px;
            animation: fadeInUp 0.8s ease-out;
        }

        .sync-controls {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
            animation: fadeInUp 0.8s ease-out 0.2s both;
        }

        .stat-card {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            transition: all 0.3s ease;
            border: 1px solid var(--card-border);
            position: relative;
            overflow: hidden;
        }

        .stat-card:before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            transition: left 0.5s;
        }

        .stat-card:hover:before {
            left: 100%;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.15);
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
        }

        .stat-card i {
            font-size: 2rem;
            color: var(--secondary);
            margin-bottom: 10px;
            transition: transform 0.3s ease;
        }

        .stat-card:hover i {
            transform: scale(1.2);
        }

        .stat-card h3 {
            font-size: 1.8rem;
            margin-bottom: 5px;
        }

        .section {
            background: var(--card-bg);
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 30px;
            animation: fadeInUp 0.8s ease-out 0.4s both;
            backdrop-filter: blur(10px);
            border: 1px solid var(--card-border);
        }

        .section h2 {
            color: var(--secondary);
            margin-bottom: 20px;
            border-bottom: 2px solid var(--secondary);
            padding-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .team-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .team-card {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 20px;
            border-left: 4px solid var(--secondary);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .team-card:before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            transition: left 0.5s;
        }

        .team-card:hover:before {
            left: 100%;
        }

        .team-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
            border-left: 4px solid #e6c44c;
        }

        .team-card h3 {
            color: var(--secondary);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .team-details {
            margin-bottom: 15px;
        }

        .team-details p {
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .players-list {
            max-height: 200px;
            overflow-y: auto;
            margin-top: 10px;
        }

        .player-item {
            padding: 8px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 5px;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            transition: all 0.3s ease;
        }

        .player-item:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(5px);
        }

        .player-name {
            font-weight: 600;
        }

        /* Tournament Bracket */
        .tournament-bracket {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .bracket-stage {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid var(--secondary);
            transition: all 0.3s ease;
        }

        .bracket-stage:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .bracket-stage h3 {
            color: var(--secondary);
            margin-bottom: 15px;
            text-align: center;
        }

        .bracket-matches {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .bracket-match {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .bracket-match:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateX(5px);
        }

        .bracket-match.winner-team1 {
            border-left: 4px solid var(--success);
        }

        .bracket-match.winner-team2 {
            border-left: 4px solid var(--info);
        }

        .match-teams {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .team-name {
            flex: 1;
            padding: 5px 10px;
            border-radius: 5px;
            transition: all 0.3s ease;
        }

        .team-name.winner {
            background: rgba(76, 175, 80, 0.3);
            font-weight: bold;
        }

        .vs {
            margin: 0 10px;
            color: var(--secondary);
            font-weight: bold;
        }

        .match-actions {
            display: flex;
            gap: 5px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .action-btn {
            padding: 5px 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 3px;
        }

        .action-btn:hover {
            transform: scale(1.05);
        }

        .winner-btn {
            background: var(--success);
            color: white;
        }

        .reset-btn {
            background: var(--accent);
            color: white;
        }

        .pairing-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .pair-btn {
            background: var(--secondary);
            color: var(--primary);
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .pair-btn:hover {
            background: #e6c44c;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        /* School Management */
        .school-management {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .school-category {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 10px;
            border: 1px solid var(--card-border);
        }

        .school-category h3 {
            color: var(--secondary);
            margin-bottom: 15px;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .school-list {
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 15px;
        }

        .school-item {
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }

        .school-item:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateX(5px);
        }

        .school-input {
            display: flex;
            gap: 10px;
        }

        .school-input input {
            flex: 1;
            padding: 8px;
            border-radius: 5px;
            border: 1px solid var(--card-border);
            background: rgba(0, 0, 0, 0.3);
            color: white;
        }

        /* Team Details Modal */
        .team-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--dark);
            padding: 30px;
            border-radius: 15px;
            max-width: 90%;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            border: 2px solid var(--secondary);
            box-shadow: 0 20px 40px rgba(0,0,0,0.5);
        }

        .close-modal {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 1.5rem;
            color: var(--secondary);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .close-modal:hover {
            transform: scale(1.2);
            color: #e6c44c;
        }

        .team-details-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .team-details-section {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 8px;
            border-left: 3px solid var(--secondary);
        }

        .players-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 10px;
            max-height: 400px;
            overflow-y: auto;
            padding: 10px;
        }

        .player-card {
            background: rgba(255, 255, 255, 0.05);
            padding: 10px;
            border-radius: 5px;
            border-left: 3px solid var(--secondary);
            transition: all 0.3s ease;
        }

        .player-card:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-2px);
        }

        /* Messages */
        .message {
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
            animation: slideIn 0.5s ease-out;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: opacity 0.3s ease;
            border-left: 4px solid;
        }

        .message i {
            font-size: 1.2rem;
        }

        .success {
            background: rgba(76, 175, 80, 0.2);
            border: 1px solid var(--success);
            color: #a3d8a3;
            border-left-color: var(--success);
        }

        .error {
            background: rgba(198, 40, 40, 0.2);
            border: 1px solid var(--accent);
            color: #ffa3a3;
            border-left-color: var(--accent);
        }

        .warning {
            background: rgba(255, 152, 0, 0.2);
            border: 1px solid var(--warning);
            color: #ffd699;
            border-left-color: var(--warning);
        }

        /* Data Management */
        .data-management {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            border: 1px solid var(--card-border);
        }

        .data-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .data-btn {
            background: var(--secondary);
            color: var(--primary);
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            min-width: 200px;
        }

        .data-btn:hover {
            background: #e6c44c;
            transform: translateY(-2px);
        }

        /* Footer */
        footer {
            background: rgba(0, 0, 0, 0.7);
            padding: 25px;
            text-align: center;
            border-radius: 10px;
            margin-top: 30px;
            animation: fadeInUp 0.8s ease-out 0.6s both;
            border: 1px solid var(--card-border);
        }

        .contact-info {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .contact-item {
            display: flex;
            align-items: center;
            gap: 10px;
            transition: transform 0.3s ease;
        }

        .contact-item:hover {
            transform: scale(1.05);
        }

        .contact-item i {
            color: var(--secondary);
        }

        .developer {
            font-style: italic;
            opacity: 0.8;
        }

        /* Digital Scoreboard Styles */
        .scoreboard-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 2000;
            animation: fadeIn 0.3s ease;
        }

        .scoreboard-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--dark);
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 800px;
            border: 3px solid var(--secondary);
            box-shadow: 0 0 40px rgba(212, 175, 55, 0.5);
        }

        .scoreboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            border-bottom: 2px solid var(--secondary);
            padding-bottom: 15px;
        }

        .scoreboard-teams {
            display: flex;
            justify-content: space-between;
            margin-bottom: 25px;
            text-align: center;
        }

        .scoreboard-team {
            flex: 1;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            margin: 0 10px;
            transition: all 0.3s ease;
        }

        .scoreboard-team.active {
            background: rgba(212, 175, 55, 0.2);
            border: 2px solid var(--secondary);
        }

        .team-score {
            font-size: 4rem;
            font-weight: bold;
            margin: 15px 0;
            color: var(--secondary);
        }

        .score-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 25px;
        }

        .score-btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .score-btn.team1 {
            background: var(--info);
            color: white;
        }

        .score-btn.team2 {
            background: var(--success);
            color: white;
        }

        .score-btn.reset {
            background: var(--accent);
            color: white;
        }

        .score-btn.cancel {
            background: var(--warning);
            color: white;
        }

        .score-btn:hover {
            transform: scale(1.05);
        }

        .player-selection {
            margin-top: 25px;
            max-height: 300px;
            overflow-y: auto;
        }

        .player-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .player-select-btn {
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 5px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
        }

        .player-select-btn:hover {
            background: rgba(212, 175, 55, 0.3);
            transform: translateY(-2px);
        }

        .scoring-log {
            margin-top: 20px;
            max-height: 200px;
            overflow-y: auto;
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 8px;
        }

        .scoring-event {
            padding: 8px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
        }

        .match-play-btn {
            padding: 5px 10px;
            background: var(--secondary);
            color: var(--primary);
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            margin-left: 10px;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }

        .match-play-btn:hover {
            background: #e6c44c;
            transform: scale(1.05);
        }

        /* Tournament Results Modal */
        .results-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 2000;
            animation: fadeIn 0.5s ease;
        }

        .results-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--dark);
            padding: 40px;
            border-radius: 15px;
            width: 90%;
            max-width: 800px;
            border: 3px solid var(--secondary);
            text-align: center;
            box-shadow: 0 0 50px rgba(212, 175, 55, 0.7);
        }

        .winner-trophy {
            font-size: 4rem;
            color: var(--secondary);
            margin-bottom: 20px;
            animation: pulse 2s infinite;
        }

        .winner-team {
            font-size: 2.5rem;
            color: var(--secondary);
            margin-bottom: 10px;
        }

        .runner-up-team {
            font-size: 1.8rem;
            color: #ccc;
            margin-bottom: 30px;
        }

        .top-scorer-info {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 4px solid var(--secondary);
        }

        .top-scorer-name {
            font-size: 1.8rem;
            color: var(--secondary);
            margin-bottom: 10px;
        }

        .top-scorer-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .top-scorer-stat {
            background: rgba(255, 255, 255, 0.05);
            padding: 10px;
            border-radius: 8px;
        }

        .certificate-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .certificate-btn {
            padding: 12px 25px;
            background: var(--secondary);
            color: var(--primary);
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .certificate-btn:hover {
            background: #e6c44c;
            transform: translateY(-3px);
        }

        /* Final Results Section */
        .final-results {
            background: var(--card-bg);
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 30px;
            border: 1px solid var(--card-border);
            display: none;
        }

        .final-results.show {
            display: block;
            animation: fadeInUp 0.8s ease-out;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .result-card {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            border-left: 4px solid var(--secondary);
        }

        .result-card.winner {
            border-left-color: gold;
            background: rgba(255, 215, 0, 0.1);
        }

        .result-card.runner-up {
            border-left-color: silver;
            background: rgba(192, 192, 192, 0.1);
        }

        .result-card.top-scorer {
            border-left-color: #cd7f32;
            background: rgba(205, 127, 50, 0.1);
        }

        .result-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }

        .result-card.winner .result-icon {
            color: gold;
        }

        .result-card.runner-up .result-icon {
            color: silver;
        }

        .result-card.top-scorer .result-icon {
            color: #cd7f32;
        }

        /* Certificate Styles */
        .certificate-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 3000;
            animation: fadeIn 0.5s ease;
        }

        .certificate-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 40px;
            border-radius: 15px;
            width: 90%;
            max-width: 800px;
            color: #333;
            text-align: center;
            box-shadow: 0 0 40px rgba(0, 0, 0, 0.5);
        }

        .certificate-border {
            border: 20px solid var(--primary);
            padding: 40px;
            position: relative;
        }

        .certificate-header {
            margin-bottom: 30px;
        }

        .certificate-title {
            font-size: 2.5rem;
            color: var(--primary);
            margin-bottom: 10px;
        }

        .certificate-subtitle {
            font-size: 1.5rem;
            color: var(--dark);
            margin-bottom: 30px;
        }

        .certificate-body {
            margin: 30px 0;
        }

        .certificate-player {
            font-size: 2.2rem;
            color: var(--dark);
            margin-bottom: 15px;
            font-weight: bold;
        }

        .certificate-school {
            font-size: 1.8rem;
            color: var(--primary);
            margin-bottom: 10px;
        }

        .certificate-achievement {
            font-size: 1.5rem;
            color: #555;
            margin-bottom: 30px;
            font-style: italic;
        }

        .certificate-footer {
            margin-top: 40px;
            display: flex;
            justify-content: space-between;
            border-top: 2px solid var(--primary);
            padding-top: 20px;
        }

        .certificate-signature {
            text-align: center;
        }

        .signature-line {
            border-top: 1px solid #333;
            width: 200px;
            margin: 5px auto;
        }

        /* Animations */
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        /* Category Tabs */
        .category-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .category-tab {
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid var(--card-border);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        .category-tab.active {
            background: var(--secondary);
            color: var(--primary);
        }

        .category-tab:hover {
            transform: translateY(-2px);
        }

        .category-content {
            display: none;
        }

        .category-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .tournament-bracket {
                grid-template-columns: 1fr;
            }
            
            .team-grid {
                grid-template-columns: 1fr;
            }
            
            .contact-info {
                flex-direction: column;
                gap: 15px;
            }
            
            .dashboard-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .match-teams {
                flex-direction: column;
                gap: 10px;
            }
            
            .vs {
                margin: 5px 0;
            }
            
            .school-management {
                grid-template-columns: 1fr;
            }
            
            .modal-content {
                max-width: 95%;
                width: 95%;
                padding: 20px;
            }
            
            .team-details-grid {
                grid-template-columns: 1fr;
            }
            
            .players-grid {
                grid-template-columns: 1fr;
            }
            
            .data-actions {
                flex-direction: column;
            }
            
            .data-btn {
                min-width: auto;
            }
            
            .sync-controls {
                flex-direction: column;
            }
            
            .scoreboard-teams {
                flex-direction: column;
                gap: 15px;
            }
            
            .score-controls {
                flex-direction: column;
            }
            
            .player-list {
                grid-template-columns: 1fr;
            }
            
            .certificate-actions {
                flex-direction: column;
            }
            
            .certificate-footer {
                flex-direction: column;
                gap: 20px;
            }
            
            .results-grid {
                grid-template-columns: 1fr;
            }
            
            .category-tabs {
                flex-direction: column;
            }
            
            .team-actions {
                flex-direction: column;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .players-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container">
            <h1 class="title">Tournament Host Dashboard</h1>
            <p>Ottapalam Sub District Sanskrit Football Tournament - Real-time Management</p>
        </div>
    </header>

    <div class="container">
        <!-- Login Section -->
        <section id="loginSection" class="login-section">
            <h2><i class="fas fa-lock"></i> Host Login</h2>
            <form id="loginForm">
                <div class="form-group">
                    <label for="password"><i class="fas fa-key"></i> Password</label>
                    <input type="password" id="password" name="password" required placeholder="Enter host password">
                </div>
                <button type="submit" class="submit-btn">
                    <i class="fas fa-sign-in-alt"></i> Login to Dashboard
                </button>
            </form>
            <div id="loginMessage" class="message" style="display: none;"></div>
        </section>

        <!-- Dashboard -->
        <section id="dashboard" class="dashboard">
            <div class="dashboard-header">
                <h2><i class="fas fa-tachometer-alt"></i> Tournament Management</h2>
                <div>
                    <button id="logoutBtn" class="submit-btn">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                    <div class="sync-controls">
                        <button id="generateBracketBtn" class="pair-btn">
                            <i class="fas fa-trophy"></i> Generate Tournament
                        </button>
                        <button id="resetBracketBtn" class="pair-btn">
                            <i class="fas fa-undo"></i> Reset Tournament
                        </button>
                        <button id="exportDataBtn" class="pair-btn">
                            <i class="fas fa-download"></i> Export Data
                        </button>
                        <button id="refreshDataBtn" class="pair-btn">
                            <i class="fas fa-sync-alt"></i> Refresh
                        </button>
                    </div>
                </div>
            </div>

            <!-- Final Results Section -->
            <div id="finalResults" class="final-results">
                <h2><i class="fas fa-award"></i> Tournament Final Results</h2>
                <div class="category-tabs" id="resultsTabs">
                    <div class="category-tab active" data-category="all">All Results</div>
                    <div class="category-tab" data-category="up">UP Results</div>
                    <div class="category-tab" data-category="hs">HS Results</div>
                </div>
                <div class="results-grid" id="resultsGrid">
                    <!-- Results will be populated here -->
                </div>
            </div>

            <!-- Data Management -->
            <div class="data-management">
                <h3><i class="fas fa-database"></i> Data Management</h3>
                <div class="data-actions">
                    <button class="data-btn" onclick="exportLocalData()">
                        <i class="fas fa-download"></i> Export All Data
                    </button>
                    <button class="data-btn" onclick="importLocalData()">
                        <i class="fas fa-upload"></i> Import Data
                    </button>
                    <button class="data-btn" onclick="syncWithCloud()">
                        <i class="fas fa-cloud"></i> Sync with Cloud
                    </button>
                    <input type="file" id="importFile" accept=".json" style="display: none;" onchange="handleFileImport(this.files[0])">
                </div>
            </div>

            <!-- Stats -->
            <div class="stats-grid">
                <div class="stat-card">
                    <i class="fas fa-users"></i>
                    <h3 id="totalTeams">0</h3>
                    <p>Total Teams</p>
                </div>
                <div class="stat-card">
                    <i class="fas fa-trophy"></i>
                    <h3 id="upTeams">0</h3>
                    <p>UP Teams</p>
                </div>
                <div class="stat-card">
                    <i class="fas fa-futbol"></i>
                    <h3 id="hsTeams">0</h3>
                    <p>HS Teams</p>
                </div>
                <div class="stat-card">
                    <i class="fas fa-calendar-alt"></i>
                    <h3 id="totalMatches">0</h3>
                    <p>Total Matches</p>
                </div>
                <div class="stat-card">
                    <i class="fas fa-sync-alt"></i>
                    <h3 id="teamCounter">0</h3>
                    <p>Teams Registered</p>
                    <small id="lastUpdate">Last update: Never</small>
                </div>
            </div>

            <!-- School Management -->
            <div class="section">
                <h2><i class="fas fa-school"></i> School Management</h2>
                <div class="school-management">
                    <div class="school-category">
                        <h3><i class="fas fa-child"></i> UP Schools</h3>
                        <div class="school-list" id="upSchoolsList"></div>
                        <div class="school-input">
                            <input type="text" id="newUpSchool" placeholder="Add new UP school">
                            <button class="pair-btn" onclick="addSchool('up')">
                                <i class="fas fa-plus"></i> Add
                            </button>
                        </div>
                    </div>
                    <div class="school-category">
                        <h3><i class="fas fa-user-graduate"></i> HS Schools</h3>
                        <div class="school-list" id="hsSchoolsList"></div>
                        <div class="school-input">
                            <input type="text" id="newHsSchool" placeholder="Add new HS school">
                            <button class="pair-btn" onclick="addSchool('hs')">
                                <i class="fas fa-plus"></i> Add
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Registered Teams -->
            <div class="section">
                <h2><i class="fas fa-list"></i> Registered Teams</h2>
                <div class="category-tabs" id="teamsTabs">
                    <div class="category-tab active" data-category="all">All Teams</div>
                    <div class="category-tab" data-category="up">UP Teams</div>
                    <div class="category-tab" data-category="hs">HS Teams</div>
                </div>
                <div class="team-grid" id="teamsContainer">
                    <!-- Teams will be populated here -->
                </div>
            </div>

            <!-- Tournament Bracket -->
            <div class="section">
                <h2><i class="fas fa-trophy"></i> Tournament Bracket</h2>
                <div class="pairing-controls">
                    <select id="categoryFilter">
                        <option value="all">All Categories</option>
                        <option value="up">UP Category</option>
                        <option value="hs">HS Category</option>
                    </select>
                    <button id="viewBracketBtn" class="pair-btn">
                        <i class="fas fa-eye"></i> View Bracket
                    </button>
                    <button id="showFinalResultsBtn" class="pair-btn">
                        <i class="fas fa-award"></i> Show Final Results
                    </button>
                </div>
                <div class="tournament-bracket" id="tournamentBracket">
                    <!-- Tournament bracket will be populated here -->
                </div>
            </div>
        </section>

        <!-- Team Details Modal -->
        <div id="teamModal" class="team-modal">
            <div class="modal-content">
                <span class="close-modal">×</span>
                <div id="teamModalContent">
                    <!-- Team details will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Edit Team Modal -->
        <div id="editTeamModal" class="edit-team-modal">
            <div class="edit-team-content">
                <div class="edit-team-header">
                    <h2><i class="fas fa-edit"></i> Edit Team</h2>
                    <span class="close-modal" id="closeEditTeamModal">×</span>
                </div>
                <div class="edit-team-form" id="editTeamForm">
                    <!-- Team form will be dynamically populated here -->
                </div>
            </div>
        </div>

        <!-- Digital Scoreboard Overlay -->
        <div id="scoreboardOverlay" class="scoreboard-overlay">
            <div class="scoreboard-content">
                <div class="scoreboard-header">
                    <h2><i class="fas fa-tv"></i> Digital Scoreboard</h2>
                    <span class="close-modal" id="closeScoreboard">×</span>
                </div>
                <div class="scoreboard-teams">
                    <div class="scoreboard-team" id="scoreboardTeam1">
                        <h3 id="scoreTeam1Name">Team 1</h3>
                        <div class="team-score" id="scoreTeam1">0</div>
                        <p>Goals: <span id="goalsTeam1">0</span></p>
                    </div>
                    <div class="vs" style="align-self: center; font-size: 2rem; font-weight: bold;">VS</div>
                    <div class="scoreboard-team" id="scoreboardTeam2">
                        <h3 id="scoreTeam2Name">Team 2</h3>
                        <div class="team-score" id="scoreTeam2">0</div>
                        <p>Goals: <span id="goalsTeam2">0</span></p>
                    </div>
                </div>
                
                <div class="score-controls">
                    <button class="score-btn team1" id="scoreTeam1Btn">
                        <i class="fas fa-futbol"></i> Team 1 Scored
                    </button>
                    <button class="score-btn reset" id="resetScoreBtn">
                        <i class="fas fa-undo"></i> Reset Score
                    </button>
                    <button class="score-btn cancel" id="cancelScoreBtn">
                        <i class="fas fa-times"></i> Cancel
                    </button>
                    <button class="score-btn team2" id="scoreTeam2Btn">
                        <i class="fas fa-futbol"></i> Team 2 Scored
                    </button>
                </div>
                
                <div id="playerSelection" class="player-selection" style="display: none;">
                    <h3>Select Player Who Scored:</h3>
                    <div class="player-list" id="playerList">
                        <!-- Players will be listed here -->
                    </div>
                    <div style="text-align: center; margin-top: 15px;">
                        <button class="score-btn cancel" id="cancelPlayerSelection">
                            <i class="fas fa-times"></i> Cancel Player Selection
                        </button>
                    </div>
                </div>
                
                <div class="scoring-log">
                    <h3>Scoring Log</h3>
                    <div id="scoringEvents">
                        <!-- Scoring events will be listed here -->
                    </div>
                </div>
                
                <div style="text-align: center; margin-top: 20px;">
                    <button class="submit-btn" id="finalizeMatchBtn">
                        <i class="fas fa-flag-checkered"></i> Finalize Match
                    </button>
                </div>
            </div>
        </div>

        <!-- Tournament Results Modal -->
        <div id="resultsModal" class="results-modal">
            <div class="results-content">
                <div class="winner-trophy">
                    <i class="fas fa-trophy"></i>
                </div>
                <h2>Tournament Results</h2>
                <div class="winner-team" id="winnerTeamName">Champion Team</div>
                <div class="runner-up-team" id="runnerUpTeamName">Runner-up Team</div>
                
                <div class="top-scorer-info">
                    <h3>Top Scorer</h3>
                    <div class="top-scorer-name" id="topScorerName">Player Name</div>
                    <div class="top-scorer-details" id="topScorerDetails">
                        School: <span id="topScorerSchool">School Name</span> | 
                        Goals: <span id="topScorerGoals">0</span>
                    </div>
                    <div class="top-scorer-stats" id="topScorerStats">
                        <!-- Additional stats will be added here -->
                    </div>
                </div>
                
                <div class="certificate-actions">
                    <button class="certificate-btn" id="generateWinnerCertificates">
                        <i class="fas fa-certificate"></i> Winner Certificates
                    </button>
                    <button class="certificate-btn" id="generateRunnerUpCertificates">
                        <i class="fas fa-certificate"></i> Runner-up Certificates
                    </button>
                    <button class="certificate-btn" id="closeResultsModal">
                        <i class="fas fa-times"></i> Close
                    </button>
                </div>
            </div>
        </div>

        <!-- Certificate Modal -->
        <div id="certificateModal" class="certificate-modal">
            <div class="certificate-content">
                <div class="certificate-border">
                    <div class="certificate-header">
                        <div class="certificate-title">Certificate of Achievement</div>
                        <div class="certificate-subtitle">Ottapalam Sub District Sanskrit Football Tournament</div>
                    </div>
                    
                    <div class="certificate-body">
                        <p>This certifies that</p>
                        <div class="certificate-player" id="certificatePlayerName">Player Name</div>
                        <div class="certificate-school" id="certificateSchoolName">School Name</div>
                        <div class="certificate-achievement" id="certificateAchievement">Achievement Description</div>
                        <p>has demonstrated exceptional skill, sportsmanship, and dedication throughout the tournament.</p>
                    </div>
                    
                    <div class="certificate-footer">
                        <div class="certificate-signature">
                            <div class="signature-line"></div>
                            <p>Tournament Director</p>
                        </div>
                        <div class="certificate-date">
                            <p id="certificateDate">Date</p>
                        </div>
                    </div>
                </div>
                
                <div style="margin-top: 30px;">
                    <button class="submit-btn" id="printCertificate">
                        <i class="fas fa-print"></i> Print Certificate
                    </button>
                    <button class="submit-btn" id="closeCertificate" style="background: var(--accent);">
                        <i class="fas fa-times"></i> Close
                    </button>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer>
            <div class="contact-info">
                <div class="contact-item">
                    <i class="fas fa-phone"></i>
                    <span>+91 90489 22948</span>
                </div>
                <div class="contact-item">
                    <i class="fas fa-envelope"></i>
                    <span>ashrafpombra@gmail.com</span>
                </div>
                <div class="contact-item">
                    <i class="fas fa-map-marker-alt"></i>
                    <span>Ottapalam, Kerala</span>
                </div>
            </div>
            <div class="developer">
                <i class="fas fa-heart" style="color: #e74c3c;"></i> Designed by Fadi.v PTM HSS
            </div>
        </footer>
    </div>

    <script>
        // Supabase Configuration
        const SUPABASE_URL = 'https://ggbuhexzigkhpshegtvq.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdnYnVoZXh6aWdraHBzaGVndHZxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIzNDA4MDksImV4cCI6MjA3NzkxNjgwOX0.nvPTmUXIFOJfp875VkNty54HY7d9-871DI-q7pzouWs';
        
        // Initialize Supabase client
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // Password for host access
        const HOST_PASSWORD = "ashrafhost";
        
        // Data storage
        let registeredTeams = [];
        let schools = { up: [], hs: [] };
        let tournamentBrackets = { up: { stages: [] }, hs: { stages: [] } };
        
        // Global scoring data storage
        let allScoringEvents = [];
        let allPlayerGoals = {};
        
        // Real-time subscription
        let teamsSubscription = null;

        // DOM Elements
        const loginSection = document.getElementById('loginSection');
        const dashboard = document.getElementById('dashboard');
        const loginForm = document.getElementById('loginForm');
        const loginMessage = document.getElementById('loginMessage');
        const logoutBtn = document.getElementById('logoutBtn');
        const teamsContainer = document.getElementById('teamsContainer');
        const tournamentBracket = document.getElementById('tournamentBracket');
        const totalTeamsEl = document.getElementById('totalTeams');
        const upTeamsEl = document.getElementById('upTeams');
        const hsTeamsEl = document.getElementById('hsTeams');
        const totalMatchesEl = document.getElementById('totalMatches');
        const generateBracketBtn = document.getElementById('generateBracketBtn');
        const resetBracketBtn = document.getElementById('resetBracketBtn');
        const viewBracketBtn = document.getElementById('viewBracketBtn');
        const exportDataBtn = document.getElementById('exportDataBtn');
        const refreshDataBtn = document.getElementById('refreshDataBtn');
        const categoryFilter = document.getElementById('categoryFilter');
        const teamModal = document.getElementById('teamModal');
        const teamModalContent = document.getElementById('teamModalContent');
        const closeModal = document.querySelector('.close-modal');
        const upSchoolsList = document.getElementById('upSchoolsList');
        const hsSchoolsList = document.getElementById('hsSchoolsList');
        const teamCounter = document.getElementById('teamCounter');
        const lastUpdate = document.getElementById('lastUpdate');
        const finalResults = document.getElementById('finalResults');
        const resultsGrid = document.getElementById('resultsGrid');
        const showFinalResultsBtn = document.getElementById('showFinalResultsBtn');
        const teamsTabs = document.getElementById('teamsTabs');
        const resultsTabs = document.getElementById('resultsTabs');

        // New DOM Elements for team editing
        const editTeamModal = document.getElementById('editTeamModal');
        const closeEditTeamModal = document.getElementById('closeEditTeamModal');
        const editTeamForm = document.getElementById('editTeamForm');

        // New global variables for scoreboard
        let currentMatchData = null;
        let scoringEvents = [];
        let playerGoals = {};
        let activeScoringTeam = null;
        
        // New global variables for team editing
        let currentEditingTeam = null;
        let currentEditingTeamIndex = -1;
        
        // DOM Elements for new features
        const scoreboardOverlay = document.getElementById('scoreboardOverlay');
        const closeScoreboard = document.getElementById('closeScoreboard');
        const scoreTeam1Name = document.getElementById('scoreTeam1Name');
        const scoreTeam2Name = document.getElementById('scoreTeam2Name');
        const scoreTeam1 = document.getElementById('scoreTeam1');
        const scoreTeam2 = document.getElementById('scoreTeam2');
        const goalsTeam1 = document.getElementById('goalsTeam1');
        const goalsTeam2 = document.getElementById('goalsTeam2');
        const scoreTeam1Btn = document.getElementById('scoreTeam1Btn');
        const scoreTeam2Btn = document.getElementById('scoreTeam2Btn');
        const resetScoreBtn = document.getElementById('resetScoreBtn');
        const cancelScoreBtn = document.getElementById('cancelScoreBtn');
        const playerSelection = document.getElementById('playerSelection');
        const playerList = document.getElementById('playerList');
        const cancelPlayerSelection = document.getElementById('cancelPlayerSelection');
        const scoringEventsDiv = document.getElementById('scoringEvents');
        const finalizeMatchBtn = document.getElementById('finalizeMatchBtn');
        const resultsModal = document.getElementById('resultsModal');
        const winnerTeamName = document.getElementById('winnerTeamName');
        const runnerUpTeamName = document.getElementById('runnerUpTeamName');
        const topScorerName = document.getElementById('topScorerName');
        const topScorerSchool = document.getElementById('topScorerSchool');
        const topScorerGoals = document.getElementById('topScorerGoals');
        const topScorerStats = document.getElementById('topScorerStats');
        const generateWinnerCertificates = document.getElementById('generateWinnerCertificates');
        const generateRunnerUpCertificates = document.getElementById('generateRunnerUpCertificates');
        const closeResultsModal = document.getElementById('closeResultsModal');
        const certificateModal = document.getElementById('certificateModal');
        const certificatePlayerName = document.getElementById('certificatePlayerName');
        const certificateSchoolName = document.getElementById('certificateSchoolName');
        const certificateAchievement = document.getElementById('certificateAchievement');
        const certificateDate = document.getElementById('certificateDate');
        const printCertificate = document.getElementById('printCertificate');
        const closeCertificate = document.getElementById('closeCertificate');

        // Check if user is already logged in
        if (localStorage.getItem('hostLoggedIn') === 'true') {
            showDashboard();
            initializeDataSync();
        } else {
            showLogin();
        }
        
        // Login form submission
        loginForm.addEventListener('submit', function(e) {
            e.preventDefault();
            const password = document.getElementById('password').value;
            
            if (password === HOST_PASSWORD) {
                localStorage.setItem('hostLoggedIn', 'true');
                showDashboard();
                initializeDataSync();
                showLoginMessage('Login successful! Loading dashboard...', 'success');
            } else {
                showLoginMessage('Incorrect password. Please try again.', 'error');
            }
        });
        
        // Logout functionality
        logoutBtn.addEventListener('click', function() {
            if (teamsSubscription) {
                supabase.removeChannel(teamsSubscription);
            }
            localStorage.removeItem('hostLoggedIn');
            showLogin();
            showLoginMessage('Logged out successfully', 'success');
        });
        
        // Generate tournament bracket
        generateBracketBtn.addEventListener('click', function() {
            generateTournamentBrackets();
        });
        
        // Reset tournament bracket
        resetBracketBtn.addEventListener('click', function() {
            if (confirm('Are you sure you want to reset the tournament? All match results will be lost.')) {
                tournamentBrackets = { up: { stages: [] }, hs: { stages: [] } };
                allScoringEvents = [];
                allPlayerGoals = {};
                saveBrackets();
                renderTournamentBracket();
                updateStats();
                finalResults.classList.remove('show');
                showMessage('Tournament reset successfully', 'success');
            }
        });
        
        // View bracket
        viewBracketBtn.addEventListener('click', function() {
            renderTournamentBracket();
        });
        
        // Show final results
        showFinalResultsBtn.addEventListener('click', function() {
            showFinalResults();
        });
        
        // Export data
        exportDataBtn.addEventListener('click', function() {
            exportLocalData();
        });
        
        // Refresh data
        refreshDataBtn.addEventListener('click', function() {
            syncRegistrationData();
            showMessage('<i class="fas fa-sync-alt"></i> Data refreshed successfully', 'success');
        });
        
        // Close modal
        closeModal.addEventListener('click', function() {
            teamModal.style.display = 'none';
        });

        // Close edit team modal
        closeEditTeamModal.addEventListener('click', function() {
            editTeamModal.style.display = 'none';
        });

        // Close modal when clicking outside
        window.addEventListener('click', function(event) {
            if (event.target === teamModal) {
                teamModal.style.display = 'none';
            }
            if (event.target === scoreboardOverlay) {
                closeScoreboardOverlay();
            }
            if (event.target === editTeamModal) {
                editTeamModal.style.display = 'none';
            }
        });

        // Event Listeners for new features
        closeScoreboard.addEventListener('click', closeScoreboardOverlay);
        scoreTeam1Btn.addEventListener('click', () => openPlayerSelection('team1'));
        scoreTeam2Btn.addEventListener('click', () => openPlayerSelection('team2'));
        resetScoreBtn.addEventListener('click', resetScoreboard);
        cancelScoreBtn.addEventListener('click', closeScoreboardOverlay);
        cancelPlayerSelection.addEventListener('click', cancelPlayerSelectionFunc);
        finalizeMatchBtn.addEventListener('click', finalizeMatch);
        generateWinnerCertificates.addEventListener('click', () => generateCertificates('winner'));
        generateRunnerUpCertificates.addEventListener('click', () => generateCertificates('runner-up'));
        closeResultsModal.addEventListener('click', () => resultsModal.style.display = 'none');
        printCertificate.addEventListener('click', printCertificateFunc);
        closeCertificate.addEventListener('click', () => certificateModal.style.display = 'none');

        // Category tabs functionality
        teamsTabs.addEventListener('click', function(e) {
            if (e.target.classList.contains('category-tab')) {
                // Remove active class from all tabs
                teamsTabs.querySelectorAll('.category-tab').forEach(tab => {
                    tab.classList.remove('active');
                });
                // Add active class to clicked tab
                e.target.classList.add('active');
                // Render teams with selected category
                renderTeams(e.target.getAttribute('data-category'));
            }
        });

        resultsTabs.addEventListener('click', function(e) {
            if (e.target.classList.contains('category-tab')) {
                // Remove active class from all tabs
                resultsTabs.querySelectorAll('.category-tab').forEach(tab => {
                    tab.classList.remove('active');
                });
                // Add active class to clicked tab
                e.target.classList.add('active');
                // Show results with selected category
                showFinalResults(e.target.getAttribute('data-category'));
            }
        });

        // Enhanced data synchronization and team management
        async function initializeDataSync() {
            // Load initial data
            await loadTeamsFromSupabase();
            await loadSchoolsFromSupabase();
            await loadBracketsFromSupabase();
            
            // Load scoring data from localStorage
            loadScoringData();
            
            // Set up real-time subscription for teams
            teamsSubscription = supabase
                .channel('teams-changes')
                .on(
                    'postgres_changes',
                    {
                        event: '*',
                        schema: 'public',
                        table: 'teams'
                    },
                    async (payload) => {
                        console.log('Teams change received:', payload);
                        await loadTeamsFromSupabase();
                        showMessage('<i class="fas fa-users"></i> New registration received!', 'success');
                    }
                )
                .subscribe();

            // Check every 30 seconds if subscription is alive
            setInterval(() => {
                if (localStorage.getItem('hostLoggedIn') === 'true') {
                    syncRegistrationData();
                }
            }, 30000);
        }

        // Load teams from Supabase
        async function loadTeamsFromSupabase() {
            try {
                const { data, error } = await supabase
                    .from('teams')
                    .select(`
                        *,
                        players (*)
                    `)
                    .order('created_at', { ascending: false });

                if (error) throw error;

                // Convert to the format expected by your existing code
                registeredTeams = data.map(team => {
                    const teamData = {
                        id: team.id,
                        teamName: team.team_name,
                        schoolName: team.school_name,
                        category: team.category,
                        coachName: team.coach_name,
                        coachPhone: team.coach_phone,
                        submissionTime: new Date(team.submission_time).toLocaleString(),
                        timestamp: team.submission_time
                    };

                    // Add player data
                    if (team.players && team.players.length > 0) {
                        team.players.forEach((player, index) => {
                            teamData[`player${player.player_number}_name`] = player.player_name;
                            teamData[`player${player.player_number}_regno`] = player.registration_no;
                            teamData[`player${player.player_number}_class`] = player.class;
                        });
                    }

                    return teamData;
                });

                // Get active category from tabs
                const activeTab = teamsTabs.querySelector('.category-tab.active');
                const activeCategory = activeTab ? activeTab.getAttribute('data-category') : 'all';
                renderTeams(activeCategory);
                updateStats();
                updateTeamCounter();

            } catch (error) {
                console.error('Error loading teams:', error);
                showMessage('Error loading teams data', 'error');
            }
        }

        // Load schools from Supabase
        async function loadSchoolsFromSupabase() {
            try {
                const { data, error } = await supabase
                    .from('schools')
                    .select('*')
                    .order('school_name');

                if (error) throw error;

                schools = { up: [], hs: [] };
                data.forEach(school => {
                    schools[school.category].push(school.school_name);
                });

                renderSchools();

            } catch (error) {
                console.error('Error loading schools:', error);
            }
        }

        // Load brackets from Supabase
        async function loadBracketsFromSupabase() {
            try {
                const { data, error } = await supabase
                    .from('tournament_brackets')
                    .select('*')
                    .order('created_at');

                if (error) throw error;

                tournamentBrackets = { up: { stages: [] }, hs: { stages: [] } };
                
                data.forEach(bracket => {
                    if (!tournamentBrackets[bracket.category].stages) {
                        tournamentBrackets[bracket.category].stages = [];
                    }
                    
                    tournamentBrackets[bracket.category].stages.push({
                        name: bracket.stage_name,
                        matches: bracket.match_data.matches || []
                    });
                });

                renderTournamentBracket();

            } catch (error) {
                console.error('Error loading brackets:', error);
            }
        }

        // Save brackets to Supabase
        async function saveBracketsToSupabase() {
            try {
                // First, clear existing brackets for this category
                const { error: deleteError } = await supabase
                    .from('tournament_brackets')
                    .delete()
                    .neq('id', 0); // Delete all records

                if (deleteError) throw deleteError;

                // Then insert updated brackets
                const bracketsToInsert = [];
                
                // UP brackets
                if (tournamentBrackets.up.stages && tournamentBrackets.up.stages.length > 0) {
                    tournamentBrackets.up.stages.forEach(stage => {
                        bracketsToInsert.push({
                            category: 'up',
                            stage_name: stage.name,
                            match_data: { matches: stage.matches }
                        });
                    });
                }
                
                // HS brackets
                if (tournamentBrackets.hs.stages && tournamentBrackets.hs.stages.length > 0) {
                    tournamentBrackets.hs.stages.forEach(stage => {
                        bracketsToInsert.push({
                            category: 'hs',
                            stage_name: stage.name,
                            match_data: { matches: stage.matches }
                        });
                    });
                }

                if (bracketsToInsert.length > 0) {
                    const { error: insertError } = await supabase
                        .from('tournament_brackets')
                        .insert(bracketsToInsert);

                    if (insertError) throw insertError;
                }

            } catch (error) {
                console.error('Error saving brackets:', error);
                showMessage('Error saving tournament brackets', 'error');
            }
        }

        // Update the saveBrackets function to use Supabase
        function saveBrackets() {
            localStorage.setItem('tournamentBrackets', JSON.stringify(tournamentBrackets));
            saveBracketsToSupabase(); // Also save to Supabase
        }

        // Save scoring data to localStorage
        function saveScoringData() {
            localStorage.setItem('allScoringEvents', JSON.stringify(allScoringEvents));
            localStorage.setItem('allPlayerGoals', JSON.stringify(allPlayerGoals));
        }

        // Load scoring data from localStorage
        function loadScoringData() {
            const savedEvents = localStorage.getItem('allScoringEvents');
            const savedGoals = localStorage.getItem('allPlayerGoals');
            
            if (savedEvents) {
                allScoringEvents = JSON.parse(savedEvents);
            }
            
            if (savedGoals) {
                allPlayerGoals = JSON.parse(savedGoals);
            }
        }
        
        // Show login section
        function showLogin() {
            loginSection.style.display = 'block';
            dashboard.style.display = 'none';
            loginForm.reset();
        }
        
        // Show dashboard
        function showDashboard() {
            loginSection.style.display = 'none';
            dashboard.style.display = 'block';
            renderSchools();
            renderTeams();
            renderTournamentBracket();
            updateStats();
        }
        
        // Show login message
        function showLoginMessage(message, type) {
            loginMessage.innerHTML = `<i class="fas fa-${getIconName(type)}"></i> ${message}`;
            loginMessage.className = `message ${type}`;
            loginMessage.style.display = 'flex';
            
            setTimeout(() => {
                loginMessage.style.display = 'none';
            }, 3000);
        }

        // Get icon name based on message type
        function getIconName(type) {
            switch(type) {
                case 'success': return 'check-circle';
                case 'error': return 'exclamation-circle';
                case 'warning': return 'exclamation-triangle';
                default: return 'info-circle';
            }
        }
        
        // Render schools
        function renderSchools() {
            upSchoolsList.innerHTML = '';
            hsSchoolsList.innerHTML = '';
            
            schools.up.forEach((school, index) => {
                const schoolItem = document.createElement('div');
                schoolItem.className = 'school-item';
                schoolItem.innerHTML = `
                    <span><i class="fas fa-school"></i> ${school}</span>
                    <div class="school-actions">
                        <button class="school-action-btn remove-school-btn" onclick="removeSchool('up', ${index})">
                            <i class="fas fa-trash"></i> Remove
                        </button>
                    </div>
                `;
                upSchoolsList.appendChild(schoolItem);
            });
            
            schools.hs.forEach((school, index) => {
                const schoolItem = document.createElement('div');
                schoolItem.className = 'school-item';
                schoolItem.innerHTML = `
                    <span><i class="fas fa-school"></i> ${school}</span>
                    <div class="school-actions">
                        <button class="school-action-btn remove-school-btn" onclick="removeSchool('hs', ${index})">
                            <i class="fas fa-trash"></i> Remove
                        </button>
                    </div>
                `;
                hsSchoolsList.appendChild(schoolItem);
            });
        }
        
        // Add school
        async function addSchool(category) {
            const inputId = `new${category.charAt(0).toUpperCase() + category.slice(1)}School`;
            const input = document.getElementById(inputId);
            const schoolName = input.value.trim();
            
            if (schoolName) {
                try {
                    const { error } = await supabase
                        .from('schools')
                        .insert({
                            school_name: schoolName,
                            category: category
                        });

                    if (error) throw error;

                    // Reload schools from Supabase
                    await loadSchoolsFromSupabase();
                    input.value = '';
                    showMessage(`<i class="fas fa-school"></i> School added to ${category.toUpperCase()} category`, 'success');
                } catch (error) {
                    console.error('Error adding school:', error);
                    showMessage('Error adding school', 'error');
                }
            } else {
                showMessage('Please enter a school name', 'error');
            }
        }
        
        // Remove school
        async function removeSchool(category, index) {
            if (confirm('Are you sure you want to remove this school?')) {
                try {
                    const schoolName = schools[category][index];
                    
                    const { error } = await supabase
                        .from('schools')
                        .delete()
                        .eq('school_name', schoolName)
                        .eq('category', category);

                    if (error) throw error;

                    // Reload schools from Supabase
                    await loadSchoolsFromSupabase();
                    showMessage('<i class="fas fa-school"></i> School removed successfully', 'success');
                } catch (error) {
                    console.error('Error removing school:', error);
                    showMessage('Error removing school', 'error');
                }
            }
        }
        
        // Render teams with category filtering and edit functionality
        function renderTeams(category = 'all') {
            teamsContainer.innerHTML = '';
            
            let filteredTeams = registeredTeams;
            
            if (category !== 'all') {
                filteredTeams = registeredTeams.filter(team => team.category === category);
            }
            
            if (filteredTeams.length === 0) {
                teamsContainer.innerHTML = `<p style="text-align: center; padding: 40px; color: #ccc;">No ${category === 'all' ? '' : category.toUpperCase() + ' '}teams registered yet. Teams will appear here as they register.</p>`;
                return;
            }
            
            filteredTeams.forEach((team, index) => {
                const teamCard = document.createElement('div');
                teamCard.className = 'team-card';
                teamCard.setAttribute('data-team-index', registeredTeams.indexOf(team));
                
                // Count players
                const playerCount = countPlayers(team);
                
                teamCard.innerHTML = `
                    <h3><i class="fas fa-users"></i> ${team.teamName}</h3>
                    <div class="team-details">
                        <p><i class="fas fa-school"></i> <strong>School:</strong> ${team.schoolName}</p>
                        <p><i class="fas fa-tag"></i> <strong>Category:</strong> ${team.category.toUpperCase()}</p>
                        <p><i class="fas fa-user-tie"></i> <strong>Coach:</strong> ${team.coachName}</p>
                        <p><i class="fas fa-phone"></i> <strong>Contact:</strong> ${team.coachPhone}</p>
                        <p><i class="fas fa-user"></i> <strong>Players:</strong> ${playerCount}/13</p>
                        <p><i class="fas fa-clock"></i> <strong>Registered:</strong> ${team.submissionTime}</p>
                    </div>
                    <div class="team-actions">
                        <button class="team-action-btn view-details-btn" data-team-index="${registeredTeams.indexOf(team)}">
                            <i class="fas fa-eye"></i> View Details
                        </button>
                        <button class="team-action-btn edit-team-btn-action" data-team-index="${registeredTeams.indexOf(team)}">
                            <i class="fas fa-edit"></i> Edit Team
                        </button>
                        <button class="team-action-btn remove-team-btn" data-team-index="${registeredTeams.indexOf(team)}">
                            <i class="fas fa-trash"></i> Remove Team
                        </button>
                    </div>
                `;
                
                teamsContainer.appendChild(teamCard);
            });
            
            // Add event listeners for team actions
            document.querySelectorAll('.view-details-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const teamIndex = this.getAttribute('data-team-index');
                    showTeamDetails(teamIndex);
                });
            });
            
            document.querySelectorAll('.edit-team-btn-action').forEach(btn => {
                btn.addEventListener('click', function() {
                    const teamIndex = this.getAttribute('data-team-index');
                    editTeam(teamIndex);
                });
            });
            
            document.querySelectorAll('.remove-team-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const teamIndex = this.getAttribute('data-team-index');
                    removeTeam(teamIndex);
                });
            });
        }

        // Count players in a team
        function countPlayers(team) {
            let count = 0;
            for (let i = 1; i <= 13; i++) {
                if (team[`player${i}_name`] && team[`player${i}_name`].trim()) {
                    count++;
                }
            }
            return count;
        }
        
        // Edit team function
        function editTeam(teamIndex) {
            currentEditingTeamIndex = parseInt(teamIndex, 10);
            currentEditingTeam = registeredTeams[currentEditingTeamIndex];
            
            if (!currentEditingTeam) {
                showMessage('Team not found', 'error');
                return;
            }
            
            // Create the edit form
            let formHTML = `
                <div class="form-section">
                    <h3><i class="fas fa-info-circle"></i> Team Information</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="editTeamName"><i class="fas fa-users"></i> Team Name</label>
                            <input type="text" id="editTeamName" value="${currentEditingTeam.teamName || ''}" required>
                        </div>
                        <div class="form-group">
                            <label for="editSchoolName"><i class="fas fa-school"></i> School Name</label>
                            <input type="text" id="editSchoolName" value="${currentEditingTeam.schoolName || ''}" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="editCategory"><i class="fas fa-tag"></i> Category</label>
                            <select id="editCategory" required>
                                <option value="up" ${currentEditingTeam.category === 'up' ? 'selected' : ''}>UP</option>
                                <option value="hs" ${currentEditingTeam.category === 'hs' ? 'selected' : ''}>HS</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="editCoachName"><i class="fas fa-user-tie"></i> Coach Name</label>
                            <input type="text" id="editCoachName" value="${currentEditingTeam.coachName || ''}" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="editCoachPhone"><i class="fas fa-phone"></i> Coach Phone</label>
                            <input type="text" id="editCoachPhone" value="${currentEditingTeam.coachPhone || ''}" required>
                        </div>
                    </div>
                </div>
                
                <div class="form-section">
                    <h3><i class="fas fa-users"></i> Player Details</h3>
                    <div class="players-grid" id="editPlayersGrid">
            `;
            
            // Add player fields
            for (let i = 1; i <= 13; i++) {
                const playerName = currentEditingTeam[`player${i}_name`] || '';
                const playerRegNo = currentEditingTeam[`player${i}_regno`] || '';
                const playerClass = currentEditingTeam[`player${i}_class`] || '';
                
                formHTML += `
                    <div class="player-form">
                        <h4><i class="fas fa-user"></i> Player ${i}</h4>
                        <div class="form-group">
                            <label for="editPlayer${i}Name">Player Name</label>
                            <input type="text" id="editPlayer${i}Name" value="${playerName}">
                        </div>
                        <div class="form-group">
                            <label for="editPlayer${i}RegNo">Registration No</label>
                            <input type="text" id="editPlayer${i}RegNo" value="${playerRegNo}">
                        </div>
                        <div class="form-group">
                            <label for="editPlayer${i}Class">Class</label>
                            <input type="text" id="editPlayer${i}Class" value="${playerClass}">
                        </div>
                    </div>
                `;
            }
            
            formHTML += `
                    </div>
                </div>
                
                <div class="edit-team-actions">
                    <button class="edit-team-btn save" id="saveTeamChanges">
                        <i class="fas fa-save"></i> Save Changes
                    </button>
                    <button class="edit-team-btn cancel" id="cancelTeamEdit">
                        <i class="fas fa-times"></i> Cancel
                    </button>
                </div>
            `;
            
            editTeamForm.innerHTML = formHTML;
            
            // Add event listeners for the form buttons
            document.getElementById('saveTeamChanges').addEventListener('click', saveEditedTeam);
            document.getElementById('cancelTeamEdit').addEventListener('click', () => {
                editTeamModal.style.display = 'none';
            });
            
            // Show the edit modal
            editTeamModal.style.display = 'block';
        }
        
        // Save edited team function
        async function saveEditedTeam() {
            try {
                // Get form values
                const teamName = document.getElementById('editTeamName').value.trim();
                const schoolName = document.getElementById('editSchoolName').value.trim();
                const category = document.getElementById('editCategory').value;
                const coachName = document.getElementById('editCoachName').value.trim();
                const coachPhone = document.getElementById('editCoachPhone').value.trim();
                
                if (!teamName || !schoolName || !coachName || !coachPhone) {
                    showMessage('Please fill in all required fields', 'error');
                    return;
                }
                
                // Collect player data
                const players = [];
                for (let i = 1; i <= 13; i++) {
                    const playerName = document.getElementById(`editPlayer${i}Name`).value.trim();
                    const playerRegNo = document.getElementById(`editPlayer${i}RegNo`).value.trim();
                    const playerClass = document.getElementById(`editPlayer${i}Class`).value.trim();
                    
                    if (playerName) {
                        players.push({
                            player_number: i,
                            player_name: playerName,
                            registration_no: playerRegNo,
                            class: playerClass
                        });
                    }
                }
                
                // Update team in Supabase
                const { error: teamError } = await supabase
                    .from('teams')
                    .update({
                        team_name: teamName,
                        school_name: schoolName,
                        category: category,
                        coach_name: coachName,
                        coach_phone: coachPhone
                    })
                    .eq('id', currentEditingTeam.id);

                if (teamError) throw teamError;

                // Delete existing players for this team
                const { error: deleteError } = await supabase
                    .from('players')
                    .delete()
                    .eq('team_id', currentEditingTeam.id);

                if (deleteError) throw deleteError;

                // Insert updated players
                if (players.length > 0) {
                    const playersToInsert = players.map(player => ({
                        ...player,
                        team_id: currentEditingTeam.id
                    }));

                    const { error: playersError } = await supabase
                        .from('players')
                        .insert(playersToInsert);

                    if (playersError) throw playersError;
                }

                // Reload teams
                await loadTeamsFromSupabase();
                
                // Close the modal
                editTeamModal.style.display = 'none';
                
                showMessage(`<i class="fas fa-users"></i> Team "${teamName}" updated successfully`, 'success');
                
            } catch (error) {
                console.error('Error updating team:', error);
                showMessage('Error updating team', 'error');
            }
        }
        
        // Remove team function
        async function removeTeam(teamIndex) {
            if (confirm('Are you sure you want to remove this team? This action cannot be undone.')) {
                try {
                    const team = registeredTeams[teamIndex];
                    
                    // Delete from Supabase (this will cascade to players due to foreign key)
                    const { error } = await supabase
                        .from('teams')
                        .delete()
                        .eq('id', team.id);

                    if (error) throw error;

                    // The real-time subscription will automatically update the UI
                    showMessage(`<i class="fas fa-trash"></i> Team "${team.teamName}" removed successfully`, 'success');
                    
                } catch (error) {
                    console.error('Error removing team:', error);
                    showMessage('<i class="fas fa-exclamation-circle"></i> Error removing team. Please try again.', 'error');
                }
            }
        }
        
        // Show team details in modal - ENLARGED AND ORGANIZED
        function showTeamDetails(teamIndex) {
            // Ensure we have a numeric index
            const index = parseInt(teamIndex, 10);
            if (isNaN(index)) {
                showMessage('<i class="fas fa-exclamation-circle"></i> Invalid team selected', 'error');
                return;
            }

            const team = registeredTeams[index];
            if (!team) {
                showMessage('<i class="fas fa-exclamation-circle"></i> Team not found', 'error');
                return;
            }
            
            // Count players
            const playerCount = countPlayers(team);
            
            // Create organized player cards
            let playersHtml = '<h3 style="color: var(--secondary); margin-bottom: 20px; border-bottom: 2px solid var(--secondary); padding-bottom: 10px;"><i class="fas fa-users"></i> Player Details (' + playerCount + ' Players)</h3><div class="players-grid">';
            
            for (let i = 1; i <= 13; i++) {
                const playerName = team[`player${i}_name`];
                const playerRegNo = team[`player${i}_regno`];
                const playerClass = team[`player${i}_class`];
                
                if (playerName) {
                    playersHtml += `
                        <div class="player-card">
                            <div>
                                <strong class="player-name"><i class="fas fa-user"></i> ${playerName}</strong>
                                <div><i class="fas fa-id-card"></i> Reg No: ${playerRegNo || 'N/A'}</div>
                                <div><i class="fas fa-graduation-cap"></i> Class: ${playerClass || 'N/A'}</div>
                            </div>
                        </div>
                    `;
                }
            }
            
            playersHtml += '</div>';
            
            teamModalContent.innerHTML = `
                <h2 style="color: var(--secondary); margin-bottom: 20px; text-align: center; border-bottom: 2px solid var(--secondary); padding-bottom: 15px;">
                    <i class="fas fa-users"></i> ${team.teamName || 'Unknown Team'}
                </h2>
                <div class="team-details-grid">
                    <div class="team-details-section">
                        <h3 style="color: var(--secondary); margin-bottom: 15px;"><i class="fas fa-info-circle"></i> Team Information</h3>
                        <p><i class="fas fa-school"></i> <strong>School:</strong> ${team.schoolName}</p>
                        <p><i class="fas fa-tag"></i> <strong>Category:</strong> ${team.category.toUpperCase()}</p>
                        <p><i class="fas fa-user-tie"></i> <strong>Coach:</strong> ${team.coachName}</p>
                        <p><i class="fas fa-phone"></i> <strong>Phone:</strong> ${team.coachPhone}</p>
                    </div>
                    <div class="team-details-section">
                        <h3 style="color: var(--secondary); margin-bottom: 15px;"><i class="fas fa-calendar"></i> Registration Details</h3>
                        <p><i class="fas fa-id-card"></i> <strong>Registration ID:</strong> ${team.id || 'N/A'}</p>
                        <p><i class="fas fa-clock"></i> <strong>Submission Time:</strong> ${team.submissionTime || 'N/A'}</p>
                        <p><i class="fas fa-users"></i> <strong>Total Players:</strong> ${playerCount}</p>
                        <p><i class="fas fa-database"></i> <strong>Database ID:</strong> ${team.id}</p>
                    </div>
                </div>
                ${playersHtml}
            `;
            
            teamModal.style.display = 'block';
        }
        
        // Generate tournament brackets - FIXED VERSION
        function generateTournamentBrackets() {
            const upTeams = registeredTeams.filter(team => team.category === 'up');
            const hsTeams = registeredTeams.filter(team => team.category === 'hs');
            
            if (upTeams.length === 0 && hsTeams.length === 0) {
                showMessage('No teams registered to generate tournament brackets', 'warning');
                return;
            }
            
            // Generate UP bracket
            if (upTeams.length > 0) {
                tournamentBrackets.up = createKnockoutBracket(upTeams, 'up');
            } else {
                tournamentBrackets.up = { stages: [] };
            }
            
            // Generate HS bracket
            if (hsTeams.length > 0) {
                tournamentBrackets.hs = createKnockoutBracket(hsTeams, 'hs');
            } else {
                tournamentBrackets.hs = { stages: [] };
            }
            
            saveBrackets();
            renderTournamentBracket();
            updateStats();
            
            showMessage('<i class="fas fa-trophy"></i> Tournament brackets generated successfully!', 'success');
        }
        
        // Create knockout bracket - FIXED VERSION
        function createKnockoutBracket(teams, category) {
            const bracket = { stages: [] };
            let currentTeams = [...teams];
            
            // If we have an odd number of teams, add a BYE team
            if (currentTeams.length % 2 !== 0) {
                currentTeams.push({ teamName: "BYE", isBye: true });
            }
            
            // Shuffle teams for random pairing
            const shuffledTeams = shuffleArray([...currentTeams]);
            
            // Create first round matches
            const firstRoundMatches = [];
            for (let i = 0; i < shuffledTeams.length; i += 2) {
                const team1 = shuffledTeams[i];
                const team2 = shuffledTeams[i + 1];
                
                // If one team is BYE, automatically set the other as winner
                const winner = team1.isBye ? team2.teamName : 
                              team2.isBye ? team1.teamName : null;
                
                firstRoundMatches.push({
                    team1: team1.teamName,
                    team2: team2.teamName,
                    winner: winner,
                    stage: "Round 1"
                });
            }
            
            bracket.stages.push({
                name: "Round 1",
                matches: firstRoundMatches
            });
            
            // Generate subsequent rounds
            let roundNumber = 2;
            let currentMatches = firstRoundMatches;
            
            while (currentMatches.length > 1) {
                const nextRoundMatches = [];
                
                for (let i = 0; i < currentMatches.length; i += 2) {
                    if (i + 1 < currentMatches.length) {
                        const team1 = currentMatches[i].winner || `Winner of Match ${i+1}`;
                        const team2 = currentMatches[i+1].winner || `Winner of Match ${i+2}`;
                        
                        nextRoundMatches.push({
                            team1: team1,
                            team2: team2,
                            winner: null,
                            stage: currentMatches.length === 2 ? "Final" : 
                                  currentMatches.length === 4 ? "Semi Finals" : 
                                  `Round ${roundNumber}`
                        });
                    } else {
                        // Handle odd number of matches (shouldn't happen in knockout)
                        nextRoundMatches.push({
                            team1: currentMatches[i].winner || `Winner of Match ${i+1}`,
                            team2: "BYE",
                            winner: currentMatches[i].winner || `Winner of Match ${i+1}`,
                            stage: `Round ${roundNumber}`
                        });
                    }
                }
                
                const stageName = nextRoundMatches[0].stage;
                bracket.stages.push({
                    name: stageName,
                    matches: nextRoundMatches
                });
                
                currentMatches = nextRoundMatches;
                roundNumber++;
            }
            
            return bracket;
        }
        
        // Render tournament bracket
        function renderTournamentBracket() {
            const category = categoryFilter.value;
            tournamentBracket.innerHTML = '';
            
            let bracketsToShow = [];
            
            if (category === 'all') {
                if (tournamentBrackets.up.stages.length > 0) bracketsToShow.push({ category: 'UP', bracket: tournamentBrackets.up });
                if (tournamentBrackets.hs.stages.length > 0) bracketsToShow.push({ category: 'HS', bracket: tournamentBrackets.hs });
            } else {
                const bracket = tournamentBrackets[category];
                if (bracket.stages.length > 0) {
                    bracketsToShow.push({ category: category.toUpperCase(), bracket: bracket });
                }
            }
            
            if (bracketsToShow.length === 0) {
                tournamentBracket.innerHTML = '<p style="text-align: center; padding: 40px; color: #ccc;">No tournament bracket generated yet. Click "Generate Tournament" to create one.</p>';
                return;
            }
            
            bracketsToShow.forEach(({ category, bracket }) => {
                const bracketStage = document.createElement('div');
                bracketStage.className = 'bracket-stage';
                bracketStage.innerHTML = `<h3><i class="fas fa-trophy"></i> ${category} Category</h3>`;
                
                const bracketMatches = document.createElement('div');
                bracketMatches.className = 'bracket-matches';
                
                bracket.stages.forEach(stage => {
                    const stageHeader = document.createElement('h4');
                    stageHeader.textContent = stage.name;
                    stageHeader.style.color = 'var(--secondary)';
                    stageHeader.style.margin = '15px 0 10px 0';
                    stageHeader.style.borderBottom = '1px solid var(--secondary)';
                    stageHeader.style.paddingBottom = '5px';
                    bracketMatches.appendChild(stageHeader);
                    
                    stage.matches.forEach((match, matchIndex) => {
                        const matchElement = document.createElement('div');
                        matchElement.className = `bracket-match ${match.winner === match.team1 ? 'winner-team1' : ''} ${match.winner === match.team2 ? 'winner-team2' : ''}`;
                        
                        const team1Class = match.winner === match.team1 ? 'winner' : '';
                        const team2Class = match.winner === match.team2 ? 'winner' : '';
                        
                        // Add play button if the match doesn't have a winner yet and it's not a BYE match
                        const showPlayButton = !match.winner && match.team2 !== "BYE";
                        
                        matchElement.innerHTML = `
                            <div class="match-teams">
                                <div class="team-name ${team1Class}">${match.team1}</div>
                                <div class="vs">VS</div>
                                <div class="team-name ${team2Class}">${match.team2}</div>
                                ${showPlayButton ? `
                                    <button class="match-play-btn" data-category="${category.toLowerCase()}" data-stage="${stage.name}" data-match="${matchIndex}">
                                        <i class="fas fa-play"></i> Play
                                    </button>
                                ` : ''}
                            </div>
                            <div class="match-actions">
                                ${match.team2 !== "BYE" && !match.winner ? `
                                    <button class="action-btn winner-btn" data-category="${category.toLowerCase()}" data-stage="${stage.name}" data-match="${matchIndex}" data-winner="team1">
                                        <i class="fas fa-check"></i> Team 1 Won
                                    </button>
                                    <button class="action-btn winner-btn" data-category="${category.toLowerCase()}" data-stage="${stage.name}" data-match="${matchIndex}" data-winner="team2">
                                        <i class="fas fa-check"></i> Team 2 Won
                                    </button>
                                ` : ''}
                                ${match.winner && match.team2 !== "BYE" ? `
                                    <button class="action-btn reset-btn" data-category="${category.toLowerCase()}" data-stage="${stage.name}" data-match="${matchIndex}">
                                        <i class="fas fa-undo"></i> Reset
                                    </button>
                                ` : ''}
                            </div>
                        `;
                        
                        bracketMatches.appendChild(matchElement);
                    });
                });
                
                bracketStage.appendChild(bracketMatches);
                tournamentBracket.appendChild(bracketStage);
            });
            
            // Add event listeners for match actions
            document.querySelectorAll('.winner-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const category = this.getAttribute('data-category');
                    const stage = this.getAttribute('data-stage');
                    const matchIndex = parseInt(this.getAttribute('data-match'));
                    const winner = this.getAttribute('data-winner');
                    setMatchWinner(category, stage, matchIndex, winner);
                });
            });
            
            document.querySelectorAll('.reset-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const category = this.getAttribute('data-category');
                    const stage = this.getAttribute('data-stage');
                    const matchIndex = parseInt(this.getAttribute('data-match'));
                    resetMatchWinner(category, stage, matchIndex);
                });
            });
            
            // Add event listeners for play buttons
            document.querySelectorAll('.match-play-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const category = this.getAttribute('data-category');
                    const stage = this.getAttribute('data-stage');
                    const matchIndex = parseInt(this.getAttribute('data-match'));
                    
                    const bracket = tournamentBrackets[category];
                    const stageObj = bracket.stages.find(s => s.name === stage);
                    const match = stageObj.matches[matchIndex];
                    
                    // Add category and match index to match data for reference
                    match.category = category;
                    match.stage = stage;
                    match.matchIndex = matchIndex;
                    
                    openScoreboard(match);
                });
            });
        }
        
        // Set match winner - FIXED VERSION
        function setMatchWinner(category, stage, matchIndex, winner) {
            const bracket = tournamentBrackets[category];
            const stageObj = bracket.stages.find(s => s.name === stage);
            
            if (stageObj && stageObj.matches[matchIndex]) {
                const match = stageObj.matches[matchIndex];
                match.winner = winner === 'team1' ? match.team1 : match.team2;
                
                // Update subsequent rounds
                updateSubsequentRounds(category, stage, matchIndex, match.winner);
                
                saveBrackets();
                renderTournamentBracket();
                
                showMessage(`<i class="fas fa-trophy"></i> Winner recorded: ${match.winner}`, 'success');
                
                // Check if this was the final match
                checkForTournamentCompletion(category);
            }
        }
        
        // Reset match winner - FIXED VERSION
        function resetMatchWinner(category, stage, matchIndex) {
            const bracket = tournamentBrackets[category];
            const stageObj = bracket.stages.find(s => s.name === stage);
            
            if (stageObj && stageObj.matches[matchIndex]) {
                const match = stageObj.matches[matchIndex];
                const oldWinner = match.winner;
                match.winner = null;
                
                // Reset subsequent rounds
                resetSubsequentRounds(category, stage, matchIndex, oldWinner);
                
                saveBrackets();
                renderTournamentBracket();
                
                showMessage('<i class="fas fa-undo"></i> Match result reset', 'success');
            }
        }
        
        // Update subsequent rounds - FIXED VERSION
        function updateSubsequentRounds(category, stage, matchIndex, winner) {
            const bracket = tournamentBrackets[category];
            const currentStageIndex = bracket.stages.findIndex(s => s.name === stage);
            
            // If this is not the final stage, update the next stage
            if (currentStageIndex < bracket.stages.length - 1) {
                const nextStage = bracket.stages[currentStageIndex + 1];
                const nextMatchIndex = Math.floor(matchIndex / 2);
                
                if (nextStage.matches[nextMatchIndex]) {
                    const nextMatch = nextStage.matches[nextMatchIndex];
                    
                    // Determine if this winner should be team1 or team2 in the next match
                    if (matchIndex % 2 === 0) {
                        nextMatch.team1 = winner;
                    } else {
                        nextMatch.team2 = winner;
                    }
                    
                    // If both teams in the next match are set and one is a BYE, set the winner automatically
                    if (nextMatch.team2 === "BYE") {
                        nextMatch.winner = nextMatch.team1;
                    } else if (nextMatch.team1 === "BYE") {
                        nextMatch.winner = nextMatch.team2;
                    }
                    
                    // Recursively update subsequent rounds if needed
                    if (nextMatch.winner) {
                        updateSubsequentRounds(category, nextStage.name, nextMatchIndex, nextMatch.winner);
                    }
                }
            }
        }
        
        // Reset subsequent rounds - FIXED VERSION
        function resetSubsequentRounds(category, stage, matchIndex, oldWinner) {
            const bracket = tournamentBrackets[category];
            const currentStageIndex = bracket.stages.findIndex(s => s.name === stage);
            
            // Reset all subsequent stages
            for (let i = currentStageIndex + 1; i < bracket.stages.length; i++) {
                const currentStage = bracket.stages[i];
                
                currentStage.matches.forEach((match, idx) => {
                    // Check if this match was affected by the old winner
                    if (match.team1 === oldWinner || match.team2 === oldWinner) {
                        // Reset the match
                        match.winner = null;
                        
                        // Reset the team name to the placeholder
                        if (match.team1 === oldWinner) {
                            const prevStage = bracket.stages[i-1];
                            const prevMatchIndex = idx * 2;
                            if (prevStage && prevStage.matches[prevMatchIndex]) {
                                match.team1 = prevStage.matches[prevMatchIndex].winner || `Winner of Match ${prevMatchIndex+1}`;
                            } else {
                                match.team1 = `Winner of Match ${prevMatchIndex+1}`;
                            }
                        }
                        
                        if (match.team2 === oldWinner) {
                            const prevStage = bracket.stages[i-1];
                            const prevMatchIndex = idx * 2 + 1;
                            if (prevStage && prevStage.matches[prevMatchIndex]) {
                                match.team2 = prevStage.matches[prevMatchIndex].winner || `Winner of Match ${prevMatchIndex+1}`;
                            } else {
                                match.team2 = `Winner of Match ${prevMatchIndex+1}`;
                            }
                        }
                    }
                });
            }
        }
        
        // Update statistics
        function updateStats() {
            totalTeamsEl.textContent = registeredTeams.length;
            
            const upTeams = registeredTeams.filter(team => team.category === 'up').length;
            const hsTeams = registeredTeams.filter(team => team.category === 'hs').length;
            
            upTeamsEl.textContent = upTeams;
            hsTeamsEl.textContent = hsTeams;
            
            // Calculate total matches
            let totalMatches = 0;
            if (tournamentBrackets.up.stages) {
                tournamentBrackets.up.stages.forEach(stage => {
                    totalMatches += stage.matches.length;
                });
            }
            if (tournamentBrackets.hs.stages) {
                tournamentBrackets.hs.stages.forEach(stage => {
                    totalMatches += stage.matches.length;
                });
            }
            
            totalMatchesEl.textContent = totalMatches;
            
            // Update real-time counter
            updateTeamCounter();
        }
        
        // Real-time team counter
        function updateTeamCounter() {
            teamCounter.textContent = registeredTeams.length;
            lastUpdate.textContent = `Last update: ${new Date().toLocaleTimeString()}`;
        }
        
        // Export data to CSV
        function exportData() {
            const csv = convertToCSV(registeredTeams);
            downloadCSV(csv, 'tournament-registrations.csv');
            showMessage('<i class="fas fa-download"></i> Data exported successfully', 'success');
        }
        
        function convertToCSV(data) {
            if (data.length === 0) return '';
            
            const headers = Object.keys(data[0]);
            const csvRows = [headers.join(',')];
            
            for (const row of data) {
                const values = headers.map(header => {
                    const escaped = ('' + row[header]).replace(/"/g, '""');
                    return `"${escaped}"`;
                });
                csvRows.push(values.join(','));
            }
            
            return csvRows.join('\n');
        }
        
        function downloadCSV(csv, filename) {
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.setAttribute('hidden', '');
            a.setAttribute('href', url);
            a.setAttribute('download', filename);
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
        
        // Export local data
        async function exportLocalData() {
            try {
                // Get all data from Supabase
                const [teamsResponse, schoolsResponse, bracketsResponse] = await Promise.all([
                    supabase.from('teams').select('*, players(*)'),
                    supabase.from('schools').select('*'),
                    supabase.from('tournament_brackets').select('*')
                ]);

                if (teamsResponse.error) throw teamsResponse.error;
                if (schoolsResponse.error) throw schoolsResponse.error;
                if (bracketsResponse.error) throw bracketsResponse.error;

                const data = {
                    teams: teamsResponse.data,
                    schools: schoolsResponse.data,
                    brackets: bracketsResponse.data,
                    scoringEvents: allScoringEvents,
                    playerGoals: allPlayerGoals,
                    exportTime: new Date().toISOString()
                };

                const dataStr = JSON.stringify(data, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `tournament-data-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
                
                showMessage('Data exported successfully!', 'success');
            } catch (error) {
                console.error('Error exporting data:', error);
                showMessage('Error exporting data', 'error');
            }
        }

        // Import local data
        function importLocalData() {
            document.getElementById('importFile').click();
        }

        // Handle file import
        async function handleFileImport(file) {
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = async function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    // Import teams
                    if (data.teams && data.teams.length > 0) {
                        for (const team of data.teams) {
                            const { error } = await supabase
                                .from('teams')
                                .upsert(team, { onConflict: 'id' });
                            
                            if (error) throw error;
                        }
                    }
                    
                    // Import schools
                    if (data.schools && data.schools.length > 0) {
                        for (const school of data.schools) {
                            const { error } = await supabase
                                .from('schools')
                                .upsert(school, { onConflict: 'id' });
                            
                            if (error) throw error;
                        }
                    }
                    
                    // Import brackets
                    if (data.brackets && data.brackets.length > 0) {
                        for (const bracket of data.brackets) {
                            const { error } = await supabase
                                .from('tournament_brackets')
                                .upsert(bracket, { onConflict: 'id' });
                            
                            if (error) throw error;
                        }
                    }
                    
                    // Import scoring data
                    if (data.scoringEvents) {
                        allScoringEvents = data.scoringEvents;
                    }
                    
                    if (data.playerGoals) {
                        allPlayerGoals = data.playerGoals;
                    }
                    
                    // Save scoring data
                    saveScoringData();
                    
                    // Reload all data
                    await loadTeamsFromSupabase();
                    await loadSchoolsFromSupabase();
                    await loadBracketsFromSupabase();
                    
                    showMessage('Data imported successfully!', 'success');
                } catch (error) {
                    console.error('Error importing data:', error);
                    showMessage('Error importing data. Invalid file format.', 'error');
                }
            };
            reader.readAsText(file);
        }

        // Sync with cloud
        async function syncWithCloud() {
            await syncRegistrationData();
            showMessage('Data synchronized with cloud successfully!', 'success');
        }

        // Update syncRegistrationData function
        async function syncRegistrationData() {
            await loadTeamsFromSupabase();
            await loadSchoolsFromSupabase();
            await loadBracketsFromSupabase();
        }
        
        // Utility function to shuffle array
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }
        
        // Show message
        function showMessage(message, type) {
            // Only remove previous temporary messages we created earlier (keep static placeholders like #loginMessage)
            const existingTemp = document.querySelectorAll('.temp-message');
            existingTemp.forEach(msg => {
                if (msg.parentNode) msg.parentNode.removeChild(msg);
            });

            const messageDiv = document.createElement('div');
            // mark this message as temporary so it can be removed safely
            messageDiv.className = `message ${type} temp-message`;
            messageDiv.innerHTML = message;

            // Insert message at top of container, before the dashboard section
            const container = document.querySelector('.container');
            if (container && dashboard) {
                container.insertBefore(messageDiv, dashboard);
            } else if (container) {
                container.appendChild(messageDiv);
            }

            // Auto-hide after 5 seconds
            setTimeout(() => {
                if (messageDiv.parentNode) {
                    messageDiv.style.opacity = '0';
                    setTimeout(() => {
                        if (messageDiv.parentNode) {
                            messageDiv.parentNode.removeChild(messageDiv);
                        }
                    }, 300);
                }
            }, 5000);
        }

        // Function to open scoreboard for a match
        function openScoreboard(matchData) {
            currentMatchData = matchData;
            scoringEvents = [];
            playerGoals = {};
            
            // Set team names
            scoreTeam1Name.textContent = matchData.team1;
            scoreTeam2Name.textContent = matchData.team2;
            
            // Reset scores
            scoreTeam1.textContent = '0';
            scoreTeam2.textContent = '0';
            goalsTeam1.textContent = '0';
            goalsTeam2.textContent = '0';
            
            // Clear scoring log
            scoringEventsDiv.innerHTML = '';
            
            // Hide player selection initially
            playerSelection.style.display = 'none';
            
            // Show scoreboard
            scoreboardOverlay.style.display = 'block';
        }
        
        // Function to close scoreboard
        function closeScoreboardOverlay() {
            scoreboardOverlay.style.display = 'none';
            currentMatchData = null;
            // Remove active team highlight
            document.getElementById('scoreboardTeam1').classList.remove('active');
            document.getElementById('scoreboardTeam2').classList.remove('active');
        }
        
        // Function to cancel player selection
        function cancelPlayerSelectionFunc() {
            playerSelection.style.display = 'none';
            // Remove active team highlight
            document.getElementById('scoreboardTeam1').classList.remove('active');
            document.getElementById('scoreboardTeam2').classList.remove('active');
        }
        
        // Function to open player selection for scoring
        function openPlayerSelection(team) {
            activeScoringTeam = team;
            
            // Highlight active team
            document.getElementById('scoreboardTeam1').classList.remove('active');
            document.getElementById('scoreboardTeam2').classList.remove('active');
            document.getElementById(`scoreboardTeam${team === 'team1' ? '1' : '2'}`).classList.add('active');
            
            // Get team name
            const teamName = team === 'team1' ? currentMatchData.team1 : currentMatchData.team2;
            
            // Find team in registered teams
            const teamData = registeredTeams.find(t => t.teamName === teamName);
            
            // Clear player list
            playerList.innerHTML = '';
            
            if (teamData) {
                // Add players to the list
                for (let i = 1; i <= 13; i++) {
                    const playerName = teamData[`player${i}_name`];
                    if (playerName && playerName.trim()) {
                        const playerBtn = document.createElement('button');
                        playerBtn.className = 'player-select-btn';
                        playerBtn.textContent = playerName;
                        playerBtn.addEventListener('click', () => recordGoal(playerName, team));
                        playerList.appendChild(playerBtn);
                    }
                }
            } else {
                // If team not found in registered teams (like "BYE" or placeholder)
                const placeholderBtn = document.createElement('button');
                placeholderBtn.className = 'player-select-btn';
                placeholderBtn.textContent = 'Unknown Player';
                placeholderBtn.addEventListener('click', () => recordGoal('Unknown Player', team));
                playerList.appendChild(placeholderBtn);
            }
            
            // Show player selection
            playerSelection.style.display = 'block';
        }
        
        // Function to record a goal
        function recordGoal(playerName, team) {
            // Update score
            const scoreElement = team === 'team1' ? scoreTeam1 : scoreTeam2;
            const goalsElement = team === 'team1' ? goalsTeam1 : goalsTeam2;
            
            let currentScore = parseInt(scoreElement.textContent);
            currentScore++;
            scoreElement.textContent = currentScore;
            
            let currentGoals = parseInt(goalsElement.textContent);
            currentGoals++;
            goalsElement.textContent = currentGoals;
            
            // Record scoring event
            const event = {
                team: team === 'team1' ? currentMatchData.team1 : currentMatchData.team2,
                player: playerName,
                time: new Date().toLocaleTimeString(),
                score: `${scoreTeam1.textContent}-${scoreTeam2.textContent}`,
                match: `${currentMatchData.team1} vs ${currentMatchData.team2}`,
                stage: currentMatchData.stage,
                category: currentMatchData.category
            };
            
            scoringEvents.push(event);
            
            // Update player goals count
            const playerKey = `${event.team}-${playerName}`;
            playerGoals[playerKey] = (playerGoals[playerKey] || 0) + 1;
            
            // Update global scoring data
            allScoringEvents.push(event);
            allPlayerGoals[playerKey] = (allPlayerGoals[playerKey] || 0) + 1;
            
            // Save scoring data
            saveScoringData();
            
            // Update scoring log
            updateScoringLog();
            
            // Hide player selection
            playerSelection.style.display = 'none';
            
            // Remove active team highlight
            document.getElementById('scoreboardTeam1').classList.remove('active');
            document.getElementById('scoreboardTeam2').classList.remove('active');
        }
        
        // Function to update scoring log
        function updateScoringLog() {
            scoringEventsDiv.innerHTML = '';
            
            scoringEvents.forEach(event => {
                const eventDiv = document.createElement('div');
                eventDiv.className = 'scoring-event';
                eventDiv.innerHTML = `
                    <span><strong>${event.team}</strong> - ${event.player}</span>
                    <span>${event.time} (${event.score})</span>
                `;
                scoringEventsDiv.appendChild(eventDiv);
            });
            
            // Scroll to bottom
            scoringEventsDiv.scrollTop = scoringEventsDiv.scrollHeight;
        }
        
        // Function to reset scoreboard
        function resetScoreboard() {
            scoreTeam1.textContent = '0';
            scoreTeam2.textContent = '0';
            goalsTeam1.textContent = '0';
            goalsTeam2.textContent = '0';
            scoringEvents = [];
            playerGoals = {};
            scoringEventsDiv.innerHTML = '';
            playerSelection.style.display = 'none';
            
            // Remove active team highlight
            document.getElementById('scoreboardTeam1').classList.remove('active');
            document.getElementById('scoreboardTeam2').classList.remove('active');
        }
        
        // Function to finalize match
        function finalizeMatch() {
            const team1Score = parseInt(scoreTeam1.textContent);
            const team2Score = parseInt(scoreTeam2.textContent);
            
            if (team1Score === team2Score) {
                showMessage('Match cannot end in a tie. Please continue playing.', 'warning');
                return;
            }
            
            const winner = team1Score > team2Score ? currentMatchData.team1 : currentMatchData.team2;
            
            // Update the match in the tournament bracket
            setMatchWinner(currentMatchData.category, currentMatchData.stage, currentMatchData.matchIndex, winner === currentMatchData.team1 ? 'team1' : 'team2');
            
            // Close scoreboard
            closeScoreboardOverlay();
            
            showMessage(`Match finalized! ${winner} wins ${team1Score}-${team2Score}`, 'success');
            
            // Check if this was the final match
            checkForTournamentCompletion(currentMatchData.category);
        }
        
        // Function to check if tournament is complete
        function checkForTournamentCompletion(category) {
            const bracket = tournamentBrackets[category];
            const finalStage = bracket.stages[bracket.stages.length - 1];
            
            if (finalStage && finalStage.matches.length === 1 && finalStage.matches[0].winner) {
                // Tournament is complete for this category
                showFinalResults();
            }
        }
        
        // Function to show final results with category filtering
        function showFinalResults(category = 'all') {
            finalResults.classList.add('show');
            resultsGrid.innerHTML = '';
            
            let hasResults = false;
            
            // Process results for each category
            for (const cat in tournamentBrackets) {
                if (category !== 'all' && category !== cat) continue;
                
                const bracket = tournamentBrackets[cat];
                const finalStage = bracket.stages[bracket.stages.length - 1];
                
                if (finalStage && finalStage.matches.length === 1 && finalStage.matches[0].winner) {
                    hasResults = true;
                    const finalMatch = finalStage.matches[0];
                    const winner = finalMatch.winner;
                    const runnerUp = finalMatch.team1 === winner ? finalMatch.team2 : finalMatch.team1;
                    
                    // Find top scorer for this category
                    const topScorer = findTopScorer(cat);
                    
                    // Create result cards
                    const winnerCard = document.createElement('div');
                    winnerCard.className = 'result-card winner';
                    winnerCard.innerHTML = `
                        <div class="result-icon">
                            <i class="fas fa-trophy"></i>
                        </div>
                        <h3>${cat.toUpperCase()} Champion</h3>
                        <div class="winner-team">${winner}</div>
                        <p>Tournament Winner</p>
                    `;
                    
                    const runnerUpCard = document.createElement('div');
                    runnerUpCard.className = 'result-card runner-up';
                    runnerUpCard.innerHTML = `
                        <div class="result-icon">
                            <i class="fas fa-medal"></i>
                        </div>
                        <h3>${cat.toUpperCase()} Runner-up</h3>
                        <div class="runner-up-team">${runnerUp}</div>
                        <p>Tournament Finalist</p>
                    `;
                    
                    const topScorerCard = document.createElement('div');
                    topScorerCard.className = 'result-card top-scorer';
                    if (topScorer) {
                        topScorerCard.innerHTML = `
                            <div class="result-icon">
                                <i class="fas fa-futbol"></i>
                            </div>
                            <h3>${cat.toUpperCase()} Top Scorer</h3>
                            <div class="top-scorer-name">${topScorer.player}</div>
                            <div class="top-scorer-school">${topScorer.school}</div>
                            <p>${topScorer.goals} Goals</p>
                        `;
                    } else {
                        topScorerCard.innerHTML = `
                            <div class="result-icon">
                                <i class="fas fa-futbol"></i>
                            </div>
                            <h3>${cat.toUpperCase()} Top Scorer</h3>
                            <div class="top-scorer-name">No Data</div>
                            <p>No goals recorded</p>
                        `;
                    }
                    
                    resultsGrid.appendChild(winnerCard);
                    resultsGrid.appendChild(runnerUpCard);
                    resultsGrid.appendChild(topScorerCard);
                }
            }
            
            if (!hasResults) {
                resultsGrid.innerHTML = '<p style="text-align: center; padding: 40px; color: #ccc; grid-column: 1 / -1;">No completed tournaments found. Complete the final matches to see results.</p>';
            }
        }
        
        // Function to find top scorer for a category
        function findTopScorer(category) {
            let topScorer = null;
            let maxGoals = 0;
            
            for (const playerKey in allPlayerGoals) {
                const [team, player] = playerKey.split('-');
                
                // Check if this player's team is in the specified category
                const teamData = registeredTeams.find(t => t.teamName === team && t.category === category);
                
                if (teamData && allPlayerGoals[playerKey] > maxGoals) {
                    maxGoals = allPlayerGoals[playerKey];
                    topScorer = { 
                        team: team,
                        player: player, 
                        school: teamData.schoolName,
                        goals: maxGoals 
                    };
                }
            }
            
            return topScorer;
        }
        
        // Function to generate certificates
        function generateCertificates(type) {
            // For this example, we'll just show a sample certificate
            // In a real implementation, you would generate certificates for all players in the team
            
            let teamName = '';
            let achievement = '';
            
            if (type === 'winner') {
                teamName = winnerTeamName.textContent;
                achievement = 'Tournament Champion';
            } else {
                teamName = runnerUpTeamName.textContent;
                achievement = 'Tournament Runner-up';
            }
            
            // Find team data
            const teamData = registeredTeams.find(t => t.teamName === teamName);
            
            if (teamData) {
                // Show certificate for the first player as an example
                const playerName = teamData.player1_name || 'Team Player';
                showCertificate(playerName, teamData.schoolName, achievement);
            } else {
                showCertificate('Team Player', teamName, achievement);
            }
        }
        
        // Function to show certificate
        function showCertificate(playerName, schoolName, achievement) {
            certificatePlayerName.textContent = playerName;
            certificateSchoolName.textContent = schoolName;
            certificateAchievement.textContent = achievement;
            certificateDate.textContent = new Date().toLocaleDateString();
            
            certificateModal.style.display = 'block';
        }
        
        // Function to print certificate
        function printCertificateFunc() {
            const certificateElement = document.querySelector('.certificate-content');
            const originalContents = document.body.innerHTML;
            
            document.body.innerHTML = certificateElement.outerHTML;
            window.print();
            document.body.innerHTML = originalContents;
            
            // Re-initialize event listeners
            initializeEventListeners();
        }
        
        // Function to re-initialize event listeners after printing
        function initializeEventListeners() {
            // Re-add event listeners that were lost after innerHTML replacement
            printCertificate.addEventListener('click', printCertificateFunc);
            closeCertificate.addEventListener('click', () => certificateModal.style.display = 'none');
        }
    </script>
</body>
</html>